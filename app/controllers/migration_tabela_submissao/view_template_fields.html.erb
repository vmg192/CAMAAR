<%# app/views/templates/_questao_fields.html.erb %>
<div class="nested-fields" data-controller="questao">
  <div class="flex justify-between items-center mb-4">
    <h4 class="text-lg font-medium text-gray-900 flex items-center gap-2">
      <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 text-blue-800 text-sm font-semibold">
        <%= f.object.ordem || 1 %>
      </span>
      Questão <%= f.index + 1 %>
    </h4>
    <div>
      <%= f.hidden_field :_destroy, data: { questao_target: "destroy" } %>
      <button type="button" 
              data-action="questao#remove"
              class="inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-red-700 bg-red-100 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
        Remover
      </button>
    </div>
  </div>
  
  <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
    <div class="sm:col-span-2">
      <%= f.label :enunciado, class: "block text-sm font-medium text-gray-700 required" %>
      <%= f.text_field :enunciado, 
            class: "mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
            placeholder: "Digite o enunciado da questão...",
            required: true %>
    </div>
    
    <div>
      <%= f.label :tipo, class: "block text-sm font-medium text-gray-700 required" %>
      <%= f.select :tipo, 
            Questao::TIPOS.map { |key, value| [value, key] }, 
            { include_blank: 'Selecione...' }, 
            { class: "mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
              required: true,
              data: { action: "change->questao#toggleOptions" } } %>
    </div>
    
    <div>
      <%= f.label :ordem, class: "block text-sm font-medium text-gray-700" %>
      <%= f.number_field :ordem, 
            class: "mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
            min: 1 %>
    </div>
  </div>
  
  <div class="questao-options hidden mt-3" data-questao-target="options">
    <%= f.label :opcoes, 'Opções (separadas por ponto e vírgula)', class: "block text-sm font-medium text-gray-700" %>
    <%= f.text_field :opcoes, 
          class: "mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",
          placeholder: "Excelente;Bom;Regular;Ruim" %>
    <p class="mt-1 text-xs text-gray-500">
      Para questões do tipo "Múltipla Escolha" e "Checkbox"
    </p>
  </div>
</div>

<%# Stimulus Controller para gerenciar questões %>
<script type="module">
  import { Controller } from "@hotwired/stimulus"
  
  export default class extends Controller {
    static targets = ["destroy", "options"]
    
    connect() {
      this.toggleOptions()
    }
    
    remove() {
      this.destroyTarget.value = "1"
      this.element.classList.add("hidden")
    }
    
    toggleOptions() {
      const tipoSelect = this.element.querySelector('select[name*="[tipo]"]')
      if (tipoSelect) {
        const showOptions = ['multipla_escolha', 'checkbox'].includes(tipoSelect.value)
        if (showOptions) {
          this.optionsTarget.classList.remove('hidden')
        } else {
          this.optionsTarget.classList.add('hidden')
        }
      }
    }
  }
</script>